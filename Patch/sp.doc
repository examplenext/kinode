                           SIMPLE PATCHER 1.0
                           ~~~~~~~~~~~~~~~~~~

                             Что новенького?

0.99beta - первая версия выпущенная на просторы FIDO для всеобщего
заюзывания и сообщения о багах.

1.0 - версия выпущенная после года отсутствия атора на гражданке
- добавлена новая команда #ECHO
- теперрь производится не только синтаксический анализ .sp файла,
  но и тарнсляция его во внтренний SP-cod с последующей интерпретацией.
- теперь патчимый файл подвергается обработке за 1 проход (раньше делалось
  по проходу для каждой сигнатуры), это должно несколько увеличить производи-
  тельность в случае если файл не умещается целиком в кэше.
- выводится номер найденой сигнатуры
- ключ /c позволяет искать сигнатуры в файлах не производя в них замены
- ключ /e позволяет создавать независимые от sp'шки EXE-модули
- собрана небольшая библиотечка .SP файлов

                            Краткое описание
        
        SIMPLE PATCHER (далее SP) представляет собой утилитку, в качестве
параметров которой передается текстовый файл оформленный должным образом
(описание формата этих файлов приводится ниже), в котором описывается какие 
последовательности байт надо найти в файлах и на что их надо заменить. 
Подобным образом устроены патчи пубилкуемые в PC games cheat листе. 


                               Запуск

       Запуск производится из командной строки со следуюзими возможными
параметрами:

SP.EXE {ключи} <имя файла.SP> {маска файлов}

где:
<имя файла.SP> - обязательный параметр-файл определенного формата (описание
формата смотри ниже) содержаший набор команд для SP'шки.

{ключи} - на данный момент программа понимает следующие ключи:

/C - режим проверки. SP'шка производит поиск заданных сигнатур, но не
     делает изменений в файлах т.е. команды #change игнорируются.

/E - в этом режиме произвидоится генерация независимого от SP'шки EXE
     модуля SP-EXE.

{маска файлов} - маска определяющая набор файлов корорый нужно обработать
SP'шкой. Этот параметр надо указывать если в .SP файле нет команды #file;
Если в .SP файле команда #file есть, то набор файлов определяемый этим
параметром будет добавлен к множеству файлов определяемых командой #file.


< skip >

                        ОПИСАНИЕ ФОРМАТА .SP ФАЙЛОВ

        Файлы используемые SP, как уже отмечалось выше, предсавляют собой
текстовые файлы оформленные следющим образом:

Cтроки начинающиеся с символа ';' интерпретируются как комментарии их
содержимое игнорируется, также игнорируются строки начинающиеся с символа
'[', это сделано для возможности оформлять .SP файлы в соответсвии со
стандартами, принятыми в эхе $CRACK$ для оформления пересылаемых креков,
в форме удобной для автоматического выдирания их из базы с сообщниями.
Так, например, начало и конец пересылаемого .SP файла можно обрамлять
строками

[BeginSP][FileName: PATCH.SP]------------------------
< тело .SP файла >
[EndSP]---------------------------------------------- 

С символа '#' начинаются команды. Текущая версия SP понимает следующие команды:

FILE <маска файлов>- необязательная команда, позволяет определить набор файлов,
                     которые необходимо пропатчить. При задании имени файла
                     в этой команде можно использовать символы '?' и '*'.
                     В файле может содержаться несколько команд FILE 
                     (в этом случае производся суммирование множества файлов
                     определяемых этими командами), а может не содержаться 
                     ниодной, в этом случае множество файлов необходимо задать
                     в командной строке вторым параметром. 
                     Примеры использования команы FILE:
                     
                     #file *.exe
                     #FILE INIT.EXE
                     #File Main.exe

SEARCH <последовательность байт>
                    - эта команда позволяет задать последовательность байт,
                      которые необходимо найти в файлах. Байты пишутся в
                      шастнадцатеричной системе счисления с указанием всех
                      назначащих нулей, разделяются байты пробелами. 
                      Если в качестве байта указать '??' или '--', то это
                      означает, что на месте этого байта может находиться
                      любой байт. Важно, чтоб последовательность не начиналась
                      с этих символов. Если ваша последовательность байт не
                      не умещается в одной строке, то ее можно перенести
                      на следующую строку. В этом случае строка должна
                      начинаться с символа '+'. Максимальная длина цепочки
                      256 байт, если надо то в следующей версии могу сделать
                      больше. Примеры использования команды SEARCH:

                      #search 2E 3A 46 ?? 75 -- 41
                      #SEARCH 37 03 00 7C 1F 0F 00 13 ?? ??
                      +3B 04 00 27 01

CHANGE <последовательность байт>
                    - эта команда определяет последовательность байт для
                      замены последовательности определенной командой
                      SEARCH, как следствие эти команды должны следовать парами.
                      Синтаксис команды CHANGE аналогичен синтаксису
                      команды SEARCH c той лиш разницей, что последовательность
                      может начинаться с символов '??' и '--', которые
                      в данном случае обозначают, что байт на данном месте
                      следует оставить без изменения. Примеры:
 
                      #search e8 1d 00 26 3a 05 75 06 47
                      #change -- -- -- -- -- -- 90 90 --


ECHO <какой-то текст>
                    - команда аналлогичная одноименной команде MS-DOS,
                      служит для вывода на экран текста, применять
                      ее имеет смысл при создании независимых EXE'шников,
                      для вывода пояснительных собщений. Пример:

                      #echo Hello world!

Остальные команды игнорируются.
                      
Программа содержит простенький синтаксический анализатор .SP файлов, так что
если Вы напишите что-то неправильно, то программа сообщит вам об этом.


                         Некоторые ограничения.

Максимальная длина сигнатуры - 256 байт
Максимальное число сигнатур в одном SP файле- 32
Максимальный размер SP-cod'а - 40000 байт



В комплекте к программе прилагается пара .SP файлов, на примере которых
можно посмотреть их устройство.

     Программа свободно распространяется принципу AS IS. Своими наблюданиями 
и соображениями по поводу дальнейщей судьбы данного продукта Вы можете 
поделиться с автором. 

                                      Victor Romanoff 2:5054/2.256@FidoNet.org
